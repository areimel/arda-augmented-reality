---
//Project Notes:
//This is a general template for creating an AR experience that uses a marker image to trigger a video, image, or 3D object.

/* =============================================== */

//Components
import VRLayout from '@layouts/AFrameLayout.astro';
import CustomUI from '@components/ARComponents/CustomUI.astro';
import ExtraUI from '@components/ARComponents/ExtraUI.astro';
import HoloBusinessCard from '@components/ARComponents/HoloBusinessCard/index.astro';

//Project Data
const projectData = await import("src/data/projectData/interactive-marker-template.json");

/*===== Main Settings =====*/
	let defaultRotation = projectData.modelSettings.defaultRotationSetting; // "flat" or "wall"
	//const defaultScale = projectData.modelSettings.defaultScale;
	const markerFile = projectData.markerFile;
	//const markerImage = projectData.markerImage;
	const experienceType = projectData.experienceType;
	const assetFile = projectData.assetFile;
	const assetHeight = projectData.assetHeight;
	const assetWidth = projectData.assetWidth;
	const assetScale = projectData.assetScale;
	const infoLink = projectData.projectBaseUrl + "/project-info";
	

/*===== Position Configurations =====*/
	let rotationSetting = "";
	let positionSetting = "";
	//Wall surface configuration - 
	let WallRotationSetting = projectData.modelSettings.wallRotationSetting;	//don't change
	let WallpositionSetting = projectData.modelSettings.wallPositionSetting;	//change as needed

	//Flat surface configuration
	let FlatRotationSetting = projectData.modelSettings.flatRotationSetting;	//don't change
	let FlatpositionSetting = projectData.modelSettings.flatPositionSetting;	//probably don't change

	//Card surface configuration
	let CardRotationSetting = projectData.modelSettings.cardRotationSetting;	//don't change
	let CardpositionSetting = projectData.modelSettings.cardPositionSetting;	//change as needed

/*===== Start-Up Settings - Processing =====*/
	if(defaultRotation == "flat"){
		rotationSetting = projectData.modelSettings.flatRotationSetting;
		positionSetting = projectData.modelSettings.flatPositionSetting;
	}else{
		rotationSetting = projectData.modelSettings.wallRotationSetting;
		positionSetting = projectData.modelSettings.wallPositionSetting;
	}

---

<VRLayout 
	title={projectData.projectName}
>
	<!-- Interaction Events Script -->
	<script is:inline>
		document.addEventListener("DOMContentLoaded", function(e){
			//detect click on buttons
			let arLinks = document.querySelectorAll('.clickable[data-link]');
			arLinks.forEach(element => {
				
				element.addEventListener('click', event => {
					console.log('ar link clicked');
					const link = element.getAttribute('data-link');
					if(link.includes('mailto')){
						window.open(link, '_blank');
					}else{
						window.open(link, '_blank');
					}
				});

			});
		});
	</script>

	<style>
		.clickable {
			cursor: pointer;
		}
	</style>

	<!-- Normal 'Page' Layer Elements -->
<!-- 	<ExtraUI infoLink={infoLink}/>
	<CustomUI/> -->

	<!-- Augmented Reality Layer -->
	<a-scene 
		renderer="colorManagement: true, physicallyCorrectLights" 
		background="color: #666" 
		raycaster="far: 100; "
		ui-controller
		camera-position
		environment
		info-message="htmlSrc: #messageText"
		loading-screen="dotsColor: red; backgroundColor: black"
		raycaster="far: 10000; objects: .clickable"
		
	>
		<!-- VR Scene Assets-->
		<a-assets>
			<img id="card" src="/images/splash-background-1.jpg" />
			<img id="banner" src="/images/Banner-Logo.jpg" />
			<img id="icon-web" src="/images/ui-icons/mdi--web.png" />
			<img id="icon-location" src="/images/ui-icons/mdi--map.png" />
			<img id="icon-profile" src="/images/ui-icons/gg--profile.png" />
			<img id="icon-phone" src="/images/ui-icons/mdi--phone.png" />
			<img id="icon-email" src="/images/ui-icons/mdi--email.png" />
			<img id="icon-play" src="/images/ui-icons/mdi--play.png" />
			<img id="icon-left" src="/images/ui-icons/mdi--arrow-left-bold.png" />
			<img id="icon-right" src="/images/ui-icons/mdi--arrow-right-bold.png" />
			
			<!-- <img id="paintandquest-preview" src="./assets/card-example/portfolio/paintandquest-preview.png" />
			<video id="paintandquest-video-mp4" autoplay="false" loop="true" src="./assets/card-example/portfolio/paintandquest.mp4"></video>
			<video id="paintandquest-video-webm" autoplay="false" loop="true" src="./assets/card-example/portfolio/paintandquest.webm"></video>
			<img id="coffeemachine-preview" src="./assets/card-example/portfolio/coffeemachine-preview.png" />
			<img id="peak-preview" src="./assets/card-example/portfolio/peak-preview.png" /> -->
			
			<!-- <a-asset-item id="avatarModel" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.2/examples/image-tracking/assets/card-example/softmind/scene.gltf"></a-asset-item> -->
		</a-assets>

		<a-entity light="type: ambient; color: #FFF"></a-entity>
		<a-entity light="type: directional; color: #FFF; intensity: 1" position="-0.5 0.75 1"></a-entity>
		<a-entity light="type: directional; color: #FFF; intensity: 1" position="0.5 0.75 1"></a-entity>



		<a-camera 
			position="0 -0.1 2"
			id="camera"
			look-controls="enabled: true"
			raycaster="far: 10000; objects: .clickable"
			cursor="fuse: false; rayOrigin: mouse;"
		></a-camera>

		<a-entity 
			rotation={rotationSetting ? rotationSetting : "90 0 0"}
			position={positionSetting ? positionSetting : "0 0 0.01"}
		>
			<HoloBusinessCard/>
			
		</a-entity>

		<!-- <a-entity
			id="center_panel"
			position="0 0 0"
			geometry="primitive: plane; width:4; height:2;"
			material="color: #000000"
			text="width: 3; wrapCount: 80; lineHeight: 50; letterSpacing: 5; color: white; font: sourcecodepro; align: left; value: Main Panel | size: 4x2 | pos: 0 0 0;"
		></a-entity> -->

	</a-scene>

</VRLayout>




